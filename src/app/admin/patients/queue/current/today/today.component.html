<div *ngIf="imeanzilishwa.value">
    <mat-accordion>
        <mat-expansion-panel [expanded]="!expand">
            <mat-expansion-panel-header>
                Update General Report
            </mat-expansion-panel-header>
            <ng-template matExpansionPanelContent>

                <mat-horizontal-stepper #generalreportstepper>
                    <mat-step [stepControl]="vitalsform">
                        <ng-template matStepLabel>Vitals</ng-template>
                        <form (ngSubmit)="updateVitalsAllegiesConditions()" [formGroup]="vitalsform" class="content"
                              class=" p-8"
                              fxFlex="1 1 auto"
                              fxLayout="column" fxLayoutAlign="start">
                            <div fxFlex="1 1 auto" fxLayout="row" fxLayoutAlign="start center">
                                <mat-form-field appearance="outline" class="pr-4 " fxFlex="15">
                                    <mat-label>height</mat-label>
                                    <input formControlName="height" matInput required>
                                    <mat-icon class="secondary-text" matSuffix>title</mat-icon>
                                </mat-form-field>
                                <mat-form-field appearance="outline" class="pr-4 " fxFlex="15">
                                    <mat-label>Weight</mat-label>
                                    <input formControlName="weight" matInput required>
                                    <mat-icon class="secondary-text" matSuffix>title</mat-icon>
                                </mat-form-field>
                                <mat-form-field appearance="outline" class="pr-4 " fxFlex="15">
                                    <mat-label>Pressure</mat-label>
                                    <input formControlName="pressure" matInput required>
                                    <mat-icon class="secondary-text" matSuffix>title</mat-icon>
                                </mat-form-field>
                                <mat-form-field appearance="outline" class="pr-4 " fxFlex="15">
                                    <mat-label>Heart Rate</mat-label>
                                    <input formControlName="heartrate" matInput required>
                                    <mat-icon class="secondary-text" matSuffix>title</mat-icon>
                                </mat-form-field>
                                <mat-form-field appearance="outline" class="pr-4 " fxFlex="15">
                                    <mat-label>Sugar</mat-label>
                                    <input formControlName="sugar" matInput required>
                                    <mat-icon class="secondary-text" matSuffix>title</mat-icon>
                                </mat-form-field>
                                <mat-form-field appearance="outline" class="pr-4 " fxFlex="15">
                                    <mat-label>Respiration</mat-label>
                                    <input formControlName="respiration" matInput required>
                                    <mat-icon class="secondary-text" matSuffix>title</mat-icon>
                                </mat-form-field>
                            </div>
                        </form>
                        <div fxFlex="1 0 auto" fxLayout="row" fxLayoutAlign="start center">
                            <button class="mx-4" color="primary" mat-raised-button>Save Only
                            </button>
                            <button class="mx-4" color="accent" mat-raised-button matStepperNext>
                                Save and Next
                            </button>
                        </div>
                    </mat-step>
                    <mat-step>
                        <form (ngSubmit)="updateVitalsAllegiesConditions()" [formGroup]="allergiesform"
                              fxFlex="1 0 auto"
                              fxLayout="column" fxLayoutAlign="start">
                            <ng-template matStepLabel>Allergies</ng-template>
                            <section
                                *ngFor="let item of allergiesform.get('allergiesformArray').controls; let i = index;"
                                formArrayName="allergiesformArray"
                                fxFlex="1 0 auto" fxLayout="column">

                                <!--Insurance company, Insurance Number-->
                                <div [formGroupName]="i" fxFlex="1 0 auto" fxLayout="row" fxLayoutAlign="start center">
                                    <mat-form-field appearance="outline" class="pr-4" fxFlex="50">
                                        <mat-label>Allergy Type</mat-label>
                                        <mat-select formControlName="type" required>
                                            <mat-option *ngFor="let option of allergytypes" [value]="option">
                                                {{option}}
                                            </mat-option>
                                        </mat-select>
                                        <mat-icon class="secondary-text" matSuffix>local_hospital</mat-icon>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" class="pl-4" fxFlex="45">
                                        <mat-label>Details</mat-label>
                                        <input formControlName="detail" matInput required>
                                        <mat-icon class="secondary-text" matSuffix>confirmation_number</mat-icon>
                                        <mat-error></mat-error>

                                    </mat-form-field>
                                    <div class="pl-8" fxFlex="5">
                                        <button (click)="deleteallergy()" color="warn" mat-mini-fab>
                                            <mat-icon>delete</mat-icon>
                                        </button>
                                    </div>
                                </div>
                            </section>
                            <div fxFlex="1 0 auto" fxLayout="column" fxLayoutAlign="start start">
                                <button (click)="addallergy()" color="primary" mat-mini-fab>
                                    <mat-icon aria-label="Example icon-button with a heart icon">add</mat-icon>
                                </button>
                                <br>
                            </div>
                        </form>
                        <div>
                            <button class="mx-4" color="primary" mat-raised-button matStepperPrevious type="button">
                                Back
                            </button>
                            <button class="mx-4" color="primary" mat-raised-button>Save Only
                            </button>
                            <button class="mx-4" color="accent" mat-raised-button matStepperNext>
                                Save and Next
                            </button>
                        </div>
                    </mat-step>
                    <mat-step>
                        <form (ngSubmit)="updateVitalsAllegiesConditions()" [formGroup]="medconditionsform"
                              fxFlex="1 0 auto"
                              fxLayout="column" fxLayoutAlign="start">
                            <ng-template matStepLabel>Conditions</ng-template>
                            <section
                                *ngFor="let item of medconditionsform.get('conditionsformArray').controls; let i = index;"
                                formArrayName="conditionsformArray"
                                fxFlex="1 0 auto" fxLayout="column">

                                <!--Insurance company, Insurance Number-->
                                <div [formGroupName]="i" fxFlex="1 0 auto" fxLayout="row" fxLayoutAlign="start center">
                                    <mat-form-field appearance="outline" class="pr-4" fxFlex="50">
                                        <mat-label>Condition Type</mat-label>
                                        <mat-select formControlName="type" required>
                                            <mat-option *ngFor="let option of medconditiontypes" [value]="option">
                                                {{option}}
                                            </mat-option>
                                        </mat-select>
                                        <mat-icon class="secondary-text" matSuffix>local_hospital</mat-icon>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline" class="pl-4" fxFlex="45">
                                        <mat-label>Details</mat-label>
                                        <input formControlName="detail" matInput required>
                                        <mat-icon class="secondary-text" matSuffix>confirmation_number</mat-icon>
                                        <mat-error></mat-error>

                                    </mat-form-field>
                                    <div class="pl-8" fxFlex="5">
                                        <button (click)="deletecondition()" color="warn" mat-mini-fab>
                                            <mat-icon>delete</mat-icon>
                                        </button>
                                    </div>
                                </div>
                            </section>
                            <div fxFlex="1 0 auto" fxLayout="column" fxLayoutAlign="start start">
                                <button (click)="addcondition()" color="primary" mat-mini-fab type="button">
                                    <mat-icon aria-label="Example icon-button with a heart icon">add</mat-icon>
                                </button>
                                <br>
                            </div>

                        </form>
                        <div>
                            <button class="mx-4" color="primary" mat-raised-button matStepperPrevious type="button">
                                Back
                            </button>
                            <button class="mx-4" color="accent" mat-raised-button matStepperNext>
                                Save
                            </button>
                        </div>
                    </mat-step>

                </mat-horizontal-stepper>
            </ng-template>
        </mat-expansion-panel>
        <mat-expansion-panel expanded>
            <mat-expansion-panel-header>
                <mat-panel-title>
                    Procedures Performed
                </mat-panel-title>
                <mat-panel-description>
                    {{currentvisit.procedures.length}}
                </mat-panel-description>
            </mat-expansion-panel-header>
            <ng-template matExpansionPanelContent>
                <div class="fullwidth">
                    <table [dataSource]="proceduresdatasource" class="fullwidth" mat-table>

                        <!--- Note that these columns can be defined in any order.
                              The actual rendered columns are set as a property on the row definition" -->


                        <ng-container matColumnDef="name">
                            <th mat-header-cell *matHeaderCellDef> Procedure</th>
                            <td mat-cell *matCellDef="let procedure"> {{procedure.name}} </td>
                        </ng-container>

                        <ng-container matColumnDef="practitioner">
                            <th mat-header-cell *matHeaderCellDef> Practitioner</th>
                            <td mat-cell *matCellDef="let procedure">
                                {{hospitaladmins| adminName : procedure.adminid }}
                                : {{procedure.metadata.lastedit?.toDate().toDateString()}}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="results">
                            <th *matHeaderCellDef mat-header-cell> Results</th>
                            <td mat-cell *matCellDef="let procedure">
                                {{procedure.results}}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="notes">
                            <th mat-header-cell *matHeaderCellDef> Notes</th>
                            <td *matCellDef="let procedure; let i = index" mat-cell>
                                <mat-chip-list>
                                    <mat-chip color="primary" selected>{{procedure.notes.length}}</mat-chip>
                                </mat-chip-list>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="action">
                            <th mat-header-cell *matHeaderCellDef> Action</th>
                            <td mat-cell *matCellDef="let procedure; let i = index">
                                <button mat-raised-button color="warn" (click)="deleteprocedure($event,i)">DELETE
                                </button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="procedurecolumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: procedurecolumns; let i = index "
                            (click)="viewnotes(i)"></tr>
                    </table>
                </div>
                <div class="row">

                    <div class="col-md-1">
                        <button (click)="performprocedures()" class="add-icon" mat-raised-button>
                            <mat-icon>add_box</mat-icon>
                            PROCEDURE
                        </button>
                    </div>
                    <div class="col-md-10">
                        <mat-paginator [pageSizeOptions]="[10, 20, 50, 100]" [pageSize]="10"
                                       showFirstLastButtons></mat-paginator>
                    </div>
                </div>
            </ng-template>
        </mat-expansion-panel>

        <mat-expansion-panel>
            <mat-expansion-panel-header>
                <mat-panel-title>
                    Perform Procedure
                </mat-panel-title>
                <mat-panel-description>
                    {{selectedprocedure?.rawprocedure?.name}}
                    --> {{getcategory(selectedprocedure?.rawprocedure?.category) }}
                </mat-panel-description>
            </mat-expansion-panel-header>
            <ng-template matExpansionPanelContent>

                <!-- HORIZONTAL STEPPER -->
                <mat-horizontal-stepper #procedurestepper [linear]="true">

                    <mat-step [stepControl]="procedureselection">
                        <ng-template matStepLabel>Select Procedure</ng-template>

                        <form [formGroup]="procedureselection" fxFlex="1 0 auto"
                              fxLayout="column" fxLayoutAlign="start">
                            <mat-form-field appearance="outline" fxFlex="100">
                                <mat-label>Select Procedure</mat-label>
                                <input [matAutocomplete]="auto" aria-label="Number" formControlName="selection" matInput
                                       type="text">
                                <mat-error>Procedure required!</mat-error>
                            </mat-form-field>
                            <mat-autocomplete #auto="matAutocomplete" [displayWith]="procedureselectiondisplayfn"
                                              fxFlex="100"
                                              fxFlex="1 0 auto" fxLayout="column"
                                              fxLayoutAlign="start">
                                <mat-option *ngFor="let procedure of filteredprocedures | async"
                                            [value]="procedure">
                                    <span fxFlex="100">{{procedure.rawProcedure.name }}</span> -->
                                    <span class="text-right text-italic"
                                          fxFlex="100">{{getcategory(procedure.rawProcedure.category) }}</span>
                                </mat-option>
                            </mat-autocomplete>
                        </form>

                        <div fxLayout="row" fxLayoutAlign="center center">
                            <button color="accent" mat-raised-button matStepperNext type="button">
                                Next
                            </button>
                        </div>
                    </mat-step>

                    <mat-step>
                        <ng-template matStepLabel>Procedure Results</ng-template>
                        <div>
                            <form (ngSubmit)="addprocedure()" [formGroup]="procedureperformed"
                                  class=" p-24"
                                  fxFlex="1 0 auto"
                                  fxLayout="column"
                                  fxLayoutAlign="start">
                                <div fxFlex="1 0 auto" fxLayout="row" fxLayoutAlign="start center">
                                    <mat-form-field appearance="outline" class="pr-4 " fxFlex="100">
                                        <mat-label>General Results</mat-label>
                                        <input formControlName="results" matInput required>
                                        <mat-icon class="secondary-text" matSuffix>title</mat-icon>
                                        <mat-error>Results required!</mat-error>
                                    </mat-form-field>
                                </div>
                                <div fxFlex="1 0 auto" fxLayout="row" fxLayoutAlign="start center">
                                    <mat-form-field appearance="outline" fxFlex="100">
                                        <mat-label>Notes</mat-label>
                                        <textarea cdkAutosizeMaxRows="25"
                                                  cdkAutosizeMinRows="2"
                                                  cdkTextareaAutosize
                                                  formControlName="notes"
                                                  matInput
                                                  required></textarea>
                                    </mat-form-field>
                                </div>
                            </form>
                            <div fxLayout="row" fxLayoutAlign="center center">
                                <button class="mr-8" color="primary" mat-raised-button matStepperPrevious
                                        type="button">
                                    Previous
                                </button>
                                <button color="accent" mat-raised-button type="submit">
                                    Save Procedure
                                </button>
                            </div>
                        </div>

                    </mat-step>

                </mat-horizontal-stepper>
                <!-- / HORIZONTAL STEPPER -->
            </ng-template>
        </mat-expansion-panel>
        <mat-expansion-panel>
            <mat-expansion-panel-header>
                <mat-panel-title>
                    Describe Prescription
                </mat-panel-title>
            </mat-expansion-panel-header>
            <ng-template matExpansionPanelContent>
                <div>
                    <div>
                        <mat-form-field appearance="outline" fxFlex="100">
                            <mat-label>Prescription</mat-label>
                            <textarea [(ngModel)]="currentvisit.prescription"
                                      cdkAutosizeMaxRows="25"
                                      cdkAutosizeMinRows="2"
                                      cdkTextareaAutosize
                                      matInput
                                      required>
                        </textarea>
                        </mat-form-field>
                    </div>
                    <div>
                        <button (click)="saveprescription()" class="mr-8" color="accent" mat-raised-button
                                type="button">
                            Save
                        </button>
                    </div>
                </div>
            </ng-template>
        </mat-expansion-panel>
    </mat-accordion>
    <br>
    <div>
        <button (click)="showadminchoice()" class="mx-4 " color="primary" mat-raised-button>Internal Referral
        </button>

        <button (click)="exitpatientandbreak()" class="mx-4 " color="primary" disabled mat-raised-button>Exit Patient
            and
            Break
        </button>

        <button (click)="exitpatientandacceptnext()" class="mx-4 " color="accent" mat-raised-button>Exit Patient and
            Accept Next
        </button>
    </div>
</div>
<mat-progress-spinner *ngIf="!imeanzilishwa.value"></mat-progress-spinner>